var CZ;(function(n){(function(t){function tt(){a=i.find("#listWelcome");e=i.find("#listCollections");o=i.find("#listFeatured");r=i.find("#listUpdated");u=i.find("#listFavorites");p=i.find("#tileCollection").html();w=i.find("#tileFeatured").html();v=i.find("#tileTimeline").html();b=i.find("#tileExhibit").html();k=i.find("#msgNoFavorite").html();d=i.find("#msgMarkPublic").html();isInCosmos(window.location.pathname)&&$("#introTourLink").removeClass("hidden");$(".overlay-list").mouseenter(function(){$(this).find(".hint").removeClass("hidden")}).mouseleave(function(){$(this).find(".hint").addClass("hidden")});(screen.width>=1024||screen.height>=768)&&($("#themePicker option:selected").attr("selected",null),$('#themePicker option[value="'+localStorage.getItem("theme")+'"]').attr("selected","selected"),$("#themePicker").change(function(){var n=$("#themePicker option:selected").val();$("body").removeClass(localStorage.getItem("theme")).addClass(n);localStorage.setItem("theme",n)}),$("#themePicker").removeClass("hidden"));y=!0;et()}function f(){n.Settings.isCosmosCollection&&$(".header-regimes").visible();$(".header-breadcrumbs").visible();i.fadeOut()}function it(t){n.HomePageViewModel.closeAllForms();$(".header-regimes").invisible();$(".header-breadcrumbs").invisible();y&&ft(t);i.fadeIn()}function rt(){var n=window.location.href.replace("//","").toLowerCase().split("/");f();n[1]=="#"?$("#regime-link-cosmos").trigger("click"):window.location.href="/#/t00000000-0000-0000-0000-000000000000@x=0"}function ut(){n.Tours.tours.length>0&&(f(),n.Tours.takeTour(n.Tours.tours[0]))}function ft(t){typeof n.Authoring!="undefined"&&typeof n.Settings!="undefined"&&t!==!1&&(t||!n.Settings.isCosmosCollection)&&(n.Authoring.isEnabled||n.Settings.isAuthorized)?(st(),ht(),a.hide(),r.hide(),e.show(),o.show(),u.show()):(ot(),e.hide(),u.hide(),a.show(),o.show(),r.show())}function et(){$.getJSON(constants.featuredContentList,function(n){var i=n?n:[],t=$("<div><\/div>");$.each(i,function(n,i){if(n<h){var r=w.replace(new RegExp("{{contentTitle}}","g"),s(i.Title)).replace("{{collectionCurator}}",i.Curator).replace("{{contentBackground}}",i.Background).replace("{{contentURL}}",i.Link);t.append(r)}});o.find(".overlay-tile").off("click").remove();o.append(t.html()).find(".overlay-tile").click(function(){$(this).attr("data-url")!=""&&(window.location.href=$(this).attr("data-url"));f()});c(o,!1)}).fail(function(){console.log("[ERROR] CZ.Overlay:populateFeatured")})}function ot(){n.Service.getRecentlyUpdatedExhibits(h).then(function(t){var u=t?t:[],i=$("<div><\/div>"),e=d;$.each(u,function(t,r){var u=n.Dates.convertCoordinateToYear(r.Year),f=b.replace("{{collectionTitle}}",s(r.CollectionName)).replace("{{collectionCurator}}",r.CuratorName).replace("{{exhibitImage}}",r.CustomBackground).replace(new RegExp("{{exhibitTitle}}","g"),s(r.Title)).replace("{{exhibitYear}}",u.year+"&nbsp;"+u.regime).replace("{{exhibitURL}}",r.Link);i.append(f)});(u.length<h||h>6)&&i.append(e);r.find(".overlay-list-note").remove();r.find(".overlay-tile").off("click").remove();r.append(i.html()).find(".overlay-tile").click(function(){$(this).attr("data-url")!=""&&(window.location.href=$(this).attr("data-url"));f()});c(r,!0)},function(){console.log("[ERROR] CZ.Overlay:populateUpdated")})}function st(){n.Service.getEditableCollections(!0).then(function(n){var i=n?n:[],t=$("<div><\/div>");$.each(i,function(n,i){var u=i.TimelineUrl||"",r=i.ImageUrl||"",f;hasDefaultBackground(r)&&(r="");r===""&&isInCosmos(u)&&(r=l);i.CurrentCollection&&(u="");f=p.replace("{{collectionURL}}",u).replace("{{collectionBackground}}",r).replace(new RegExp("{{collectionTitle}}","g"),s(i.Title)||"").replace("{{collectionCurator}}",i.Author||"");t.append(f)});e.find(".overlay-tile").off("click").remove();e.append(t.html()).find(".overlay-tile").click(function(){$(this).attr("data-url")!=""&&(window.location.href=$(this).attr("data-url"));f()});c(e,!0)},function(){console.log("[ERROR] CZ.Overlay:populateCollections")})}function ht(){n.Service.getUserFavorites().then(function(n){var i=n?n:[],t=$("<div><\/div>"),r,e;$.each(i,function(n,i){var r=i.CustomBackground||"",u;hasDefaultBackground(r)&&(r="");i.IsCosmosCollection&&(r=l);u=v.replace(new RegExp("{{timelineTitle}}","g"),s(i.Title)||"").replace("{{timelineURL}}",i.Link||"").replace("{{collectionBackground}}",r).replace("{{collectionTitle}}",s(i.CollectionName)||"").replace("{{collectionCurator}}",i.CuratorName||"");t.append(u)});i.length===0&&(r=v.replace(new RegExp("{{timelineTitle}}","g"),"Big Bang to Present Day").replace("{{timelineURL}}","/#/t00000000-0000-0000-0000-000000000000@x=0").replace("{{collectionBackground}}",l).replace("{{collectionTitle}}","Cosmos").replace("{{collectionCurator}}","ChronoZoom"),e=k,t.append(r).append(e));u.find(".overlay-list-note").remove();u.find(".overlay-tile").off("click").remove();u.append(t.html()).find(".overlay-tile").click(function(){$(this).attr("data-url")!=""&&(window.location.href=$(this).attr("data-url"));f()});c(u)},function(){console.log("[ERROR] CZ.Overlay:populateFavorites")})}function c(n,t){t=t===!0||!1;n.find('.overlay-tile:not([data-image=""])').each(function(n,i){var r=$(i);(r.attr("data-image")||!1)&&(t&&!hasBrightBackground(r.attr("data-image"))?r.css("background","linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.3)), url("+r.attr("data-image")+")").css("background-size","cover").attr("data-image",""):r.css("background","#445 url("+r.attr("data-image")+")").css("background-size","cover").attr("data-image",""))})}function s(n){return typeof n=="undefined"?"":n.replace(new RegExp("<","g"),"&lt;").replace(new RegExp(">","g"),"&gt;").replace(new RegExp('"',"g"),"&quot;")}var y=!1,h=screen.width>=1800||screen.height>=1800?9:6,g=["/images/background.jpg","/images/default-tile.png"],nt=["/images/tile-default.jpg","/images/tile-bighistory.jpg"],l="/images/tile-bighistory.jpg",i=$("#overlay"),a,e,o,r,u,p,w,v,b,k,d;t.Initialize=tt;t.Hide=f;t.Show=it;t.ExploreBigHistory=rt;t.ExploreIntroTour=ut;this.hasBrightBackground=function(n){return typeof n!="string"?!0:$.inArray(n.toLowerCase(),nt)>-1};this.hasDefaultBackground=function(n){return typeof n!="string"?!0:$.inArray(n.toLowerCase(),g)>-1};this.isInCosmos=function(n){if(typeof n!="string")return!1;var t=n.toLowerCase().split("#")[0];return $.inArray(t,["/","/chronozoom","/chronozoom/","/chronozoom/cosmos","/chronozoom/cosmos/"])>-1}})(n.Overlay||(n.Overlay={}));var t=n.Overlay})(CZ||(CZ={}));
/*
//# sourceMappingURL=overlay.min.js.map
*/